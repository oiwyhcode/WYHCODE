#include "Trace_PID.h"


void PID_Trace_realize(PID_TypeDef *pid, float CurrentValue) {
    // 1. 计算当前误差
    pid->Error = pid->target_val - CurrentValue;

    // 2. 计算积分项 (带积分限幅，防止积分饱和)
    pid->Integral += pid->Error;
    if (pid->Integral > 500) pid->Integral = 500;
    if (pid->Integral < -500) pid->Integral = -500;

    // 3. 计算微分项
    float derivative = pid->Error - pid->LastError;

    // 4. 计算总输出
    pid->output_val = (pid->Kp * pid->Error) +
                  (pid->Ki * pid->Integral) +
                  (pid->Kd * derivative);

    // 5. 更新上次误差
    pid->LastError = pid->Error;
}

